<!DOCTYPE html>
<html lang="en-us"><head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Ferret</title>

    <meta name="generator" content="Hugo 0.154.5">

    <link
        href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700"
        rel="stylesheet"
    />

    
    <link rel="stylesheet" href="https://www.montferret.dev/sass/main.min.17ed29bf1daeec53da854869c780218bf0eb5b49eeffcf3d0a114e9fac4a35df.css" />
    <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png" />
    <link
        rel="apple-touch-icon"
        sizes="114x114"
        href="/favicon/apple-icon-114x114.png"
    />
    <link
        rel="apple-touch-icon"
        sizes="120x120"
        href="/favicon/apple-icon-120x120.png"
    />
    <link
        rel="apple-touch-icon"
        sizes="144x144"
        href="/favicon/apple-icon-144x144.png"
    />
    <link
        rel="apple-touch-icon"
        sizes="152x152"
        href="/favicon/apple-icon-152x152.png"
    />
    <link
        rel="apple-touch-icon"
        sizes="180x180"
        href="/favicon/apple-icon-180x180.png"
    />
    <link
        rel="icon"
        type="image/png"
        sizes="192x192"
        href="/favicon/android-icon-192x192.png"
    />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png" />
    <link rel="manifest" href="/favicon/manifest.json" />
    
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png" />
    <meta name="theme-color" content="#ffffff" />
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135792752-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-135792752-1');
    </script>
</head>
<body><nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item" href="/">
                <img src="/img/logo.png" width="30" height="30" /> <small class="logo">ferret</small>
            </a>

            <a
                id="navbar-burger"
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="primary-nav"
            >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        
        <div id="primary-nav" class="navbar-menu">
            <div class="navbar-start">
                
                
                
                        
                        <a href="/try/" class="navbar-item "
                        title=Try&#32;it id=repl>
                            Try it
                        </a>
                
                        
                        <a href="/docs/introduction" class="navbar-item "
                        title=Project&#32;documentation id=docs>
                            Docs
                        </a>
                
                        
                        <a href="/blog/" class="navbar-item  active"
                        title=Blog id=blog>
                            Blog
                        </a>
                
                        
                        <a href="/cookbook/google-search" class="navbar-item "
                        title=Cookbook id=cookbook>
                            Cookbook
                        </a>
                
            </div>

            <div class="navbar-end">
                
                
                        <a href="https://opencollective.com/ferret" class="navbar-item "
                        title=Open&#32;collective id=donate>
                            Donate
                        </a>
                
                        <a href="https://github.com/MontFerret/ferret" class="navbar-item "
                        title=GitHub&#32;repository id=github>
                            GitHub
                        </a>
                
            </div>
        </div>
    </div>
</nav>

<script>
    
    
    (function(){
        let navburger = document.getElementById("navbar-burger");
        navburger.addEventListener("click", function() {
            let target = this.getAttribute("data-target");
            let el = document.getElementById(target);

            el.classList.toggle("is-active");
        })
    })();
</script><div id="content">
    <div class="content section blog blog-post">
        <div class="columns is-centered blog-post-header has-text-centered">
            <div class="column is-10">
                <p class="title is-2">
                    Ferret v0.8
                </p>
                <p class="subtitle is-4">
                        More features, better API
                    </p>
                <p class="subtitle is-6 has-text-grey">
                    <span>July 23, 2019</span> by <a href="https://www.twitter.com/ziflex">Tim Voronov</a>
                </p>
                <hr class="is-block-centered" />
            </div>
        </div>
        <div class="columns is-centered blog-post-content has-text-justified">
            <div class="column is-8">
                <p>Hooray, <strong><a href="https://github.com/MontFerret/ferret/releases/tag/v0.8.0">Ferret v0.8</a></strong> has been released!</p>
<p>It&rsquo;s been a while since the last release, but we worked hard to bring new and better Ferret. This release has many new exciting features, but unfortunately, there are also some breaking changes.</p>
<p>You can find the full changelog <strong><a href="https://github.com/MontFerret/ferret/blob/master/CHANGELOG.md#080">here</a></strong>.</p>
<p>Let&rsquo;s go!</p>
<h1 id="whats-added">What&rsquo;s added</h1>
<h2 id="iframe">iframe</h2>
<p>Ferret <em>finally</em> supports <code>iframe</code> elements. <br>
When a page gets loaded, Ferret finds all available elements and provieds an access to them via the <code>.frames</code> property of a page object.</p>
<p>Here&rsquo;s an example of how to find a target frame:</p>








<div class="code-editor">

    

    <button id="code-editor-197-run-button" class="run button is-pulled-right is-outlined is-light is-radiusless code-editor-button">Run</button>

    <div class="columns">
        <div class="column is-6">
            <div id="code-editor-197-text" class="code-editor-text" style="height: 250px;">
                
LET page = DOCUMENT("https://www.w3schools.com/html/html_iframe.asp", {
	driver: "cdp"
})

LET content = (
    FOR f IN page.frames
        FILTER f.URL == "https://www.w3schools.com/html/default.asp"
            RETURN f.head.innerHTML
)

RETURN FIRST(content)

            </div>
        </div>
        <div class="column is-6">
            <div id="code-editor-197-result" class="code-editor-result" style="height: 250px;"></div>
        </div>
    </div>
    

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            function createEditor(id, mode) {
                const editor = ace.edit(id);
                editor.setTheme("ace\/theme\/tomorrow_night");
                editor.session.setMode("ace/mode/" + mode);
                editor.setOptions({
                    displayIndentGuides: false,
                    printMargin: false
                });

                return editor;
            }

            const btn = document.querySelector('#code-editor-197-run-button');
            const textEditor = createEditor('code-editor-197-text', 'aql');
            const resultEditor = createEditor('code-editor-197-result', 'json');
            resultEditor.setReadOnly(true);
                textEditor.setReadOnly(true);

            function setContent(editor, content) {
                editor.setValue(content, -1);
            }

            let isRunning = false;

            function onStart() {
                isRunning = true;
                textEditor.setReadOnly(true);
                btn.classList.add('is-loading');
            }

            function onEnd(result) {
                isRunning = false;
                textEditor.setReadOnly(false);
                btn.classList.remove('is-loading');

                setContent(resultEditor, result);
            }

            btn.addEventListener('click', () => {
                if (isRunning) {
                    return;
                }

                const body = {
                        text: textEditor.getValue(),
                        params: JSON.parse("{}")
                };

                onStart();
                fetch("https:\/\/worker-pucbyp2omq-ue.a.run.app", {
                    method: 'post',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    signal: AbortSignal.timeout(1000 * 60), 
                    body: JSON.stringify(body)
                })
                    .then(r => {
                        if (r.status === 200) {
                            return r.json()
                        }
                        
                        if (r.status === 426) {
                            throw new Error(`Too many requests. Try again later.`);
                        }
                        
                        if (r.status === 400) {
                            return r.json().then((data) => {
                                throw new Error(data.error);
                            });
                        }
                        
                        throw new Error(`Unexpected error. Try again later.`);
                    })
                    .then((data) => {
                        onEnd(JSON.stringify(data, null, 4));
                    })
                    .catch((err) => {
                        onEnd(err.message);
                    });
            });
        }, false);
    </script>
</div>
<p>Alternatively, you can filter them out by url or access to a target iframe by index, if you know it&rsquo;s position.</p>
<div class="notification is-warning">
  Due to CORS security policies, you still may have issues with iframes if it points to another domain.
</div>
<h2 id="namespaces">Namespaces</h2>
<p>With this release, we introduce a new language feature - <strong>namespaces</strong>.</p>
<p>Namespaces allow library authors (and us) to isolate functions into dedicated sub sections.</p>
<p>Here is an example:</p>




<div class="code-editor">
    <div class="columns">
        <div class="column is-full">
            <div id="code-485-text" class="code-editor-text" style="height: 120px;">
                
LET blob = DOWNLOAD("https://raw.githubusercontent.com/MontFerret/ferret/master/assets/logo.png")

RETURN IO::FS::WRITE("logo.png", blob)

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = ace.edit('code-485-text');
            editor.setTheme("ace/theme/tomorrow_night");
            editor.session.setMode("ace/mode/" + 'aql');
            editor.setOptions({
                readOnly: true,
                highlightActiveLine: false,
                highlightGutterLine: false,
                displayIndentGuides: false,
                printMargin: false
            });
            editor.renderer.$cursorLayer.element.style.display = "none"
        }, false);
    </script>
</div>
<p>To namespace a function, use the new <code>namespace</code> method. The <code>namespace</code> method is chainable:</p>




<div class="code-editor">
    <div class="columns">
        <div class="column is-full">
            <div id="code-300-text" class="code-editor-text" style="height: 380px;">
                
package main

import (
	"context"
	"encoding/json"
	"fmt"
	"os"
	"strings"

	"github.com/MontFerret/ferret/pkg/compiler"
	"github.com/MontFerret/ferret/pkg/runtime/core"
	"github.com/MontFerret/ferret/pkg/runtime/values"
	"github.com/MontFerret/ferret/pkg/runtime/values/types"
)

func main() {
    c := compiler.New()
    c.Namespace("IO").Namespace("FS").RegisterFunction("Read", fs.Read)
}

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = ace.edit('code-300-text');
            editor.setTheme("ace/theme/tomorrow_night");
            editor.session.setMode("ace/mode/" + 'golang');
            editor.setOptions({
                readOnly: true,
                highlightActiveLine: false,
                highlightGutterLine: false,
                displayIndentGuides: false,
                printMargin: false
            });
            editor.renderer.$cursorLayer.element.style.display = "none"
        }, false);
    </script>
</div>
<div class="notification is-info">
	In future releases we will put HTML related functions into HTML:: namespaces.
</div>
<h2 id="xpath">XPath</h2>
<p>A good web scraping tool needs XPath support, and Ferret finally has it!<br>
Ferret provides simple interface to XPath engine for both drivers - CDP and HTTP.<br>
It automatically detects the output value type and deserializes them accordingly.</p>




<div class="code-editor">
    <div class="columns">
        <div class="column is-full">
            <div id="code-273-text" class="code-editor-text" style="height: 90px;">
                
RETURN XPATH(page, "//div[contains(@class, 'form-group')]")

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = ace.edit('code-273-text');
            editor.setTheme("ace/theme/tomorrow_night");
            editor.session.setMode("ace/mode/" + 'aql');
            editor.setOptions({
                readOnly: true,
                highlightActiveLine: false,
                highlightGutterLine: false,
                displayIndentGuides: false,
                printMargin: false
            });
            editor.renderer.$cursorLayer.element.style.display = "none"
        }, false);
    </script>
</div>




<div class="code-editor">
    <div class="columns">
        <div class="column is-full">
            <div id="code-926-text" class="code-editor-text" style="height: 90px;">
                
RETURN XPATH(page, "count(//div)")

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = ace.edit('code-926-text');
            editor.setTheme("ace/theme/tomorrow_night");
            editor.session.setMode("ace/mode/" + 'aql');
            editor.setOptions({
                readOnly: true,
                highlightActiveLine: false,
                highlightGutterLine: false,
                displayIndentGuides: false,
                printMargin: false
            });
            editor.renderer.$cursorLayer.element.style.display = "none"
        }, false);
    </script>
</div>
<p>These two queries will return 2 different types:</p>
<ol>
<li>Returns an array of serialized elements (their inner HTML)</li>
<li>Returns a number indicating how many &ldquo;div&rdquo; elements are on the page.</li>
</ol>
<h2 id="regular-expression-operator">Regular expression operator</h2>
<p>This release provides a shorthand for using regexp assertions:</p>




<div class="code-editor">
    <div class="columns">
        <div class="column is-full">
            <div id="code-265-text" class="code-editor-text" style="height: 90px;">
                
LET result = "foo" =~ "^f[o].$" // returns "true"

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = ace.edit('code-265-text');
            editor.setTheme("ace/theme/tomorrow_night");
            editor.session.setMode("ace/mode/" + 'aql');
            editor.setOptions({
                readOnly: true,
                highlightActiveLine: false,
                highlightGutterLine: false,
                displayIndentGuides: false,
                printMargin: false
            });
            editor.renderer.$cursorLayer.element.style.display = "none"
        }, false);
    </script>
</div>




<div class="code-editor">
    <div class="columns">
        <div class="column is-full">
            <div id="code-287-text" class="code-editor-text" style="height: 90px;">
                
LET result = "foo" !~ "[a-z]+bar$"  // returns "true"

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = ace.edit('code-287-text');
            editor.setTheme("ace/theme/tomorrow_night");
            editor.session.setMode("ace/mode/" + 'aql');
            editor.setOptions({
                readOnly: true,
                highlightActiveLine: false,
                highlightGutterLine: false,
                displayIndentGuides: false,
                printMargin: false
            });
            editor.renderer.$cursorLayer.element.style.display = "none"
        }, false);
    </script>
</div>
<h2 id="new-functions-to-manipulate-dom">New functions to manipulate DOM</h2>
<p>There are some cases when you might need to change the existing DOM. To help with that, we added the <code>INNER_HTML_SET</code> and <code>INNER_TEXT_SET</code> functions.</p>




<div class="code-editor">
    <div class="columns">
        <div class="column is-full">
            <div id="code-231-text" class="code-editor-text" style="height: 185px;">
                
// Using document and selector
INNER_HTML_SET(doc, "body", "<span>Hello</span>")
INNER_TEXT_SET(doc, "body", "Hello")

// Or an element directly
INNER_HTML_SET(doc.body, "<span>Hello</span>")
INNER_TEXT_SET(doc.body, "Hello")

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = ace.edit('code-231-text');
            editor.setTheme("ace/theme/tomorrow_night");
            editor.session.setMode("ace/mode/" + 'aql');
            editor.setOptions({
                readOnly: true,
                highlightActiveLine: false,
                highlightGutterLine: false,
                displayIndentGuides: false,
                printMargin: false
            });
            editor.renderer.$cursorLayer.element.style.display = "none"
        }, false);
    </script>
</div>
<h2 id="viewport-settings">Viewport settings</h2>
<p>In this release, you can override default values of a viewport in headless mode.</p>




<div class="code-editor">
    <div class="columns">
        <div class="column is-full">
            <div id="code-874-text" class="code-editor-text" style="height: 185px;">
                
LET doc = DOCUMENT(@url, {
    driver: 'cdp',
    viewport: {
        width: 1920,
        height: 1080
    }
})

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = ace.edit('code-874-text');
            editor.setTheme("ace/theme/tomorrow_night");
            editor.session.setMode("ace/mode/" + 'aql');
            editor.setOptions({
                readOnly: true,
                highlightActiveLine: false,
                highlightGutterLine: false,
                displayIndentGuides: false,
                printMargin: false
            });
            editor.renderer.$cursorLayer.element.style.display = "none"
        }, false);
    </script>
</div>
<h2 id="better-emulation-of-user-interaction">Better emulation of user interaction</h2>
<p>This is a big change in how Ferret handles page interactions.</p>
<p>Now Ferret interacts with pages in a more advanced way - your script can scrolls down or up to an element, moves the mouse, focuses and types&hellip; with random delays. Just like a real person!</p>
<h2 id="other">Other</h2>
<p>There are many other many small changes here and there, like adding <code>FOCUS</code>, <code>ESCAPE_HTML</code>, <code>UNESCAPE_HTML</code> and <code>DECODE_URI_COMPONENT</code> functions; improving performance; and changing internal design of some parts of the system.</p>
<h1 id="whats-broken">What&rsquo;s broken</h1>
<p>We try to maintain backwards compatibility, but some of the new features required serious design changes that lead to breaking compatibility with previous versions.  As we approach to release v1.0, the API is becoming more stable and will require fewer dramatic changes.</p>
<div class="notification is-info">
	Most of the breaking changes will affect only embedded solutions, use of HTML drivers in particular. No changes in the syntax, so no scripts need to change.
</div>
<h2 id="virtual-dom-structure">Virtual DOM structure</h2>
<p>Work on <code>iframe</code> support required us to redesign the structure of the virtual DOM by introducing top level entity called <code>HTMLPage</code>:</p>




<div class="code-editor">
    <div class="columns">
        <div class="column is-full">
            <div id="code-257-text" class="code-editor-text" style="height: 440px;">
                
type HTMLPage interface {
	core.Value
	core.Iterable
	core.Getter
	core.Setter
	collections.Measurable
	io.Closer

	IsClosed() values.Boolean
	GetURL() values.String
	GetMainFrame() HTMLDocument
	GetFrames(ctx context.Context) (*values.Array, error)
	GetFrame(ctx context.Context, idx values.Int) (core.Value, error)
	GetCookies(ctx context.Context) (*values.Array, error)
	SetCookies(ctx context.Context, cookies ...HTTPCookie) error
	DeleteCookies(ctx context.Context, cookies ...HTTPCookie) error
	PrintToPDF(ctx context.Context, params PDFParams) (values.Binary, error)
	CaptureScreenshot(ctx context.Context, params ScreenshotParams) (values.Binary, error)
	WaitForNavigation(ctx context.Context) error
	Navigate(ctx context.Context, url values.String) error
	NavigateBack(ctx context.Context, skip values.Int) (values.Boolean, error)
	NavigateForward(ctx context.Context, skip values.Int) (values.Boolean, error)
}

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = ace.edit('code-257-text');
            editor.setTheme("ace/theme/tomorrow_night");
            editor.session.setMode("ace/mode/" + 'golang');
            editor.setOptions({
                readOnly: true,
                highlightActiveLine: false,
                highlightGutterLine: false,
                displayIndentGuides: false,
                printMargin: false
            });
            editor.renderer.$cursorLayer.element.style.display = "none"
        }, false);
    </script>
</div>
<p>Previously, <code>HTMLDocument</code> contained the open page, but <code>iframe</code> nodes introduce the need to have multiple documents representing each node. This led to a new entity in the structure.</p>
<h2 id="driver-api">Driver API</h2>
<p>Because of the changes in Virtual DOM structure, the driver API has been changed as well in order to be reasonable.</p>
<p><code>Driver.LoadDocument</code> and <code>LoadDocumentParams</code> are renamed to <code>Driver.Open</code> and <code>Params</code>.</p>




<div class="code-editor">
    <div class="columns">
        <div class="column is-full">
            <div id="code-263-text" class="code-editor-text" style="height: 150px;">
                
type Driver interface {
	io.Closer
	Name() string
	Open(ctx context.Context, params Params) (HTMLPage, error)
}

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const editor = ace.edit('code-263-text');
            editor.setTheme("ace/theme/tomorrow_night");
            editor.session.setMode("ace/mode/" + 'golang');
            editor.setOptions({
                readOnly: true,
                highlightActiveLine: false,
                highlightGutterLine: false,
                displayIndentGuides: false,
                printMargin: false
            });
            editor.renderer.$cursorLayer.element.style.display = "none"
        }, false);
    </script>
</div>
<h2 id="other-1">Other</h2>
<p>In the context of API stabilization and consistency, there are some other minor changes in vDOM elements like extra returned value (usually an error) or <code>Get</code> prefix in some methods.</p>

            </div>
        </div>
    </div>

        </div><footer class="footer">
    <div class="columns">
        <div class="column is-4 is-hidden-mobile">
            <p>
                <a href="https://github.com/MontFerret">
                    © 2018-2026 MontFerret Team
                </a>
            </p>
            <p>
                <a href="https://www.montferret.dev/blog/index.xml">RSS</a>
            </p>
        </div>
        <div class="column is-4 has-text-centered">
            <img src="/img/logo.png" width="30" height="30" />
        </div>
        <div class="column is-4 has-text-right is-hidden-mobile">
            <a href="#">BACK TO TOP Δ</a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/ace.min.js"
        integrity="sha256-qCCcAHv/Z0u7K344shsZKUF2NR+59ooA3XWRj0LPGIQ=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/mode-aql.min.js"
        integrity="sha256-X0EL61aEe9ZmA9OkWgfPw7QMJc2DPs3/RcarIt15j8Y=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/mode-json.min.js"
        integrity="sha256-oMH6MIx8AGl0OseaL8vGcdSb9ons1Jprkf4xXAyzvNc=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/mode-golang.min.js"
        integrity="sha256-0SvSdpO3x7J6KQZ5Y9ghI0wph0l0DDMUaOQu+Swjup0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/theme-tomorrow_night.min.js"
        integrity="sha256-NbswWaBBhaLvBJ18ocfQ7sC/Iy/+7KvGq0YRjvLRpk4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/mode-sh.min.js"
        integrity="sha256-uzCsgXA65+SIa2CRZSX6+Ls6DKZkddI5rtRXr1uOE2Y=" crossorigin="anonymous"></script>
</footer></body>
</html>
