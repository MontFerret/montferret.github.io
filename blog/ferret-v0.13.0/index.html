<!DOCTYPE html>
<html lang="en-us"><head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Ferret</title>

    <meta name="generator" content="Hugo 0.154.5">

    <link
        href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700"
        rel="stylesheet"
    />

    
    <link rel="stylesheet" href="https://www.montferret.dev/sass/main.min.17ed29bf1daeec53da854869c780218bf0eb5b49eeffcf3d0a114e9fac4a35df.css" />
    <link rel="apple-touch-icon" sizes="57x57" href="/favicon/apple-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="60x60" href="/favicon/apple-icon-60x60.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/favicon/apple-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="/favicon/apple-icon-76x76.png" />
    <link
        rel="apple-touch-icon"
        sizes="114x114"
        href="/favicon/apple-icon-114x114.png"
    />
    <link
        rel="apple-touch-icon"
        sizes="120x120"
        href="/favicon/apple-icon-120x120.png"
    />
    <link
        rel="apple-touch-icon"
        sizes="144x144"
        href="/favicon/apple-icon-144x144.png"
    />
    <link
        rel="apple-touch-icon"
        sizes="152x152"
        href="/favicon/apple-icon-152x152.png"
    />
    <link
        rel="apple-touch-icon"
        sizes="180x180"
        href="/favicon/apple-icon-180x180.png"
    />
    <link
        rel="icon"
        type="image/png"
        sizes="192x192"
        href="/favicon/android-icon-192x192.png"
    />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png" />
    <link rel="manifest" href="/favicon/manifest.json" />
    
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="msapplication-TileImage" content="/favicon/ms-icon-144x144.png" />
    <meta name="theme-color" content="#ffffff" />
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135792752-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-135792752-1');
    </script>
</head>
<body><nav class="navbar" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item" href="/">
                <img src="/img/logo.png" width="30" height="30" /> <small class="logo">ferret</small>
            </a>

            <a
                id="navbar-burger"
                role="button"
                class="navbar-burger burger"
                aria-label="menu"
                aria-expanded="false"
                data-target="primary-nav"
            >
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        
        <div id="primary-nav" class="navbar-menu">
            <div class="navbar-start">
                
                
                
                        
                        <a href="/try/" class="navbar-item "
                        title=Try&#32;it id=repl>
                            Try it
                        </a>
                
                        
                        <a href="/docs/introduction" class="navbar-item "
                        title=Project&#32;documentation id=docs>
                            Docs
                        </a>
                
                        
                        <a href="/blog/" class="navbar-item  active"
                        title=Blog id=blog>
                            Blog
                        </a>
                
                        
                        <a href="/cookbook/google-search" class="navbar-item "
                        title=Cookbook id=cookbook>
                            Cookbook
                        </a>
                
            </div>

            <div class="navbar-end">
                
                
                        <a href="https://opencollective.com/ferret" class="navbar-item "
                        title=Open&#32;collective id=donate>
                            Donate
                        </a>
                
                        <a href="https://github.com/MontFerret/ferret" class="navbar-item "
                        title=GitHub&#32;repository id=github>
                            GitHub
                        </a>
                
            </div>
        </div>
    </div>
</nav>

<script>
    
    
    (function(){
        let navburger = document.getElementById("navbar-burger");
        navburger.addEventListener("click", function() {
            let target = this.getAttribute("data-target");
            let el = document.getElementById(target);

            el.classList.toggle("is-active");
        })
    })();
</script><div id="content">
    <div class="content section blog blog-post">
        <div class="columns is-centered blog-post-header has-text-centered">
            <div class="column is-10">
                <p class="title is-2">
                    Ferret v0.13.0
                </p>
                <p class="subtitle is-4">
                        Syntax change
                    </p>
                <p class="subtitle is-6 has-text-grey">
                    <span>November 24, 2020</span> by <a href="https://github.com/ziflex">Tim Voronov</a>
                </p>
                <hr class="is-block-centered" />
            </div>
        </div>
        <div class="columns is-centered blog-post-content has-text-justified">
            <div class="column is-8">
                <p>Hello friends,</p>
<p>We are excited to announce a new Ferret release - <strong><a href="https://github.com/MontFerret/ferret/releases/tag/v0.13.0">Ferret v0.13.0</a></strong>.</p>
<p>This release brings new syntax, DOM API updates and some bug fixes. Let&rsquo;s dive in!</p>
<h1 id="whats-added">What&rsquo;s added</h1>
<h2 id="while-loop">While loop</h2>
<p>Finally! While loops have landed FQL!</p>
<p>Ferret query language inherently lacked while loops due to its origin from ArangoDB query language. But over time, it&rsquo;s become obvious that this kind of looping is essential for data scraping.</p>
<p>While loops in FQL are implemented as an extension of <code>FOR IN</code> loop and come in two modes: <code>while-do</code> and <code>do-while</code>:</p>
<pre tabindex="0"><code>FOR counter [DO] WHILE condition
    RETURN value
</code></pre><p><code>while-do</code> is a traditional while loop where a condition is checked before every iteration. It might be not very useful in web scraping (e.g. pagination), thus we have implemented <code>do-while</code> where condition checks start to occur on 2nd iteration i.e. there is always at least one iteration.</p>
<p>Since data in FQL is immutable, there are no direct mutations in code which while loops can depend on. Rather while loops depend on checks of external resources like existance of HTML elements or database records.</p>
<p>Ok, enough of theory! Let&rsquo;s take a look at the query that gets a list of API managment solutions from the GitHub Marketplace:</p>








<div class="code-editor">

    

    <button id="code-editor-705-run-button" class="run button is-pulled-right is-outlined is-light is-radiusless code-editor-button">Run</button>

    <div class="columns">
        <div class="column is-6">
            <div id="code-editor-705-text" class="code-editor-text" style="height: 340px;">
                
LET doc = DOCUMENT("https://github.com/marketplace/category/api-management", { driver: "cdp"})
LET nextSelector = ".paginate-container .BtnGroup a:nth-child(2)"
LET elementsSelector = '[data-hydro-click]'

WAIT_ELEMENT(doc, elementsSelector)

FOR i DO WHILE ELEMENT_EXISTS(doc, nextSelector)
    LIMIT 2
	LET wait = i > 0 ? CLICK(doc, nextSelector) : false
	LET nav = wait ? WAIT(2000) && WAIT_ELEMENT(doc, elementsSelector) : false

	FOR el IN ELEMENTS(doc, elementsSelector)
        FILTER ELEMENT_EXISTS(el, '.h4')
		RETURN {
            url: el.attributes.href,
            name: INNER_TEXT(el, '.h4')
        }

            </div>
        </div>
        <div class="column is-6">
            <div id="code-editor-705-result" class="code-editor-result" style="height: 340px;"></div>
        </div>
    </div>
    

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            function createEditor(id, mode) {
                const editor = ace.edit(id);
                editor.setTheme("ace\/theme\/tomorrow_night");
                editor.session.setMode("ace/mode/" + mode);
                editor.setOptions({
                    displayIndentGuides: false,
                    printMargin: false
                });

                return editor;
            }

            const btn = document.querySelector('#code-editor-705-run-button');
            const textEditor = createEditor('code-editor-705-text', 'aql');
            const resultEditor = createEditor('code-editor-705-result', 'json');
            resultEditor.setReadOnly(true);
                textEditor.setReadOnly(true);

            function setContent(editor, content) {
                editor.setValue(content, -1);
            }

            let isRunning = false;

            function onStart() {
                isRunning = true;
                textEditor.setReadOnly(true);
                btn.classList.add('is-loading');
            }

            function onEnd(result) {
                isRunning = false;
                textEditor.setReadOnly(false);
                btn.classList.remove('is-loading');

                setContent(resultEditor, result);
            }

            btn.addEventListener('click', () => {
                if (isRunning) {
                    return;
                }

                const body = {
                        text: textEditor.getValue(),
                        params: JSON.parse("{}")
                };

                onStart();
                fetch("https:\/\/worker-pucbyp2omq-ue.a.run.app", {
                    method: 'post',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    signal: AbortSignal.timeout(1000 * 60), 
                    body: JSON.stringify(body)
                })
                    .then(r => {
                        if (r.status === 200) {
                            return r.json()
                        }
                        
                        if (r.status === 426) {
                            throw new Error(`Too many requests. Try again later.`);
                        }
                        
                        if (r.status === 400) {
                            return r.json().then((data) => {
                                throw new Error(data.error);
                            });
                        }
                        
                        throw new Error(`Unexpected error. Try again later.`);
                    })
                    .then((data) => {
                        onEnd(JSON.stringify(data, null, 4));
                    })
                    .catch((err) => {
                        onEnd(err.message);
                    });
            });
        }, false);
    </script>
</div>
<p>In this while loop, we are checking if the next button exists (external mutation) but always execute the loop body at least once just in case there is only one page.</p>
<p>The <code>i</code> variable represents a loop counter that gives information which iteration we are in.
Being an extension of <code>FOR-IN</code> loop gives us all statements that can be used with regular <code>FOR-IN</code> loop like <code>FILTER</code>, <code>LIMIT</code> and etc.</p>
<h2 id="computed-styles">Computed styles</h2>
<p>Until this version, CDP driver returned attribute based styles whenver you accessed them via <code>Element.style</code> or <code>Element.attributes.style</code> or <code>STYLE_GET(Element)</code>.</p>
<p>Starting with this release, <code>Element.style</code> returns an object containing computed styles while <code>Element.attributes.style</code> returns an object containg styles defined in <code>style</code> attribute of an element. <code>STYLE_GET(Element)</code> returns computed styles as well.</p>








<div class="code-editor">

    

    <button id="code-editor-301-run-button" class="run button is-pulled-right is-outlined is-light is-radiusless code-editor-button">Run</button>

    <div class="columns">
        <div class="column is-6">
            <div id="code-editor-301-text" class="code-editor-text" style="height: 200px;">
                
LET doc = DOCUMENT("https://github.com/", { driver: "cdp"})
LET el = ELEMENT(doc, "#user_email")

RETURN {
    computed: el.style,
    attribute: el.attributes.style
}

            </div>
        </div>
        <div class="column is-6">
            <div id="code-editor-301-result" class="code-editor-result" style="height: 200px;"></div>
        </div>
    </div>
    

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            function createEditor(id, mode) {
                const editor = ace.edit(id);
                editor.setTheme("ace\/theme\/tomorrow_night");
                editor.session.setMode("ace/mode/" + mode);
                editor.setOptions({
                    displayIndentGuides: false,
                    printMargin: false
                });

                return editor;
            }

            const btn = document.querySelector('#code-editor-301-run-button');
            const textEditor = createEditor('code-editor-301-text', 'aql');
            const resultEditor = createEditor('code-editor-301-result', 'json');
            resultEditor.setReadOnly(true);
                textEditor.setReadOnly(true);

            function setContent(editor, content) {
                editor.setValue(content, -1);
            }

            let isRunning = false;

            function onStart() {
                isRunning = true;
                textEditor.setReadOnly(true);
                btn.classList.add('is-loading');
            }

            function onEnd(result) {
                isRunning = false;
                textEditor.setReadOnly(false);
                btn.classList.remove('is-loading');

                setContent(resultEditor, result);
            }

            btn.addEventListener('click', () => {
                if (isRunning) {
                    return;
                }

                const body = {
                        text: textEditor.getValue(),
                        params: JSON.parse("{}")
                };

                onStart();
                fetch("https:\/\/worker-pucbyp2omq-ue.a.run.app", {
                    method: 'post',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    signal: AbortSignal.timeout(1000 * 60), 
                    body: JSON.stringify(body)
                })
                    .then(r => {
                        if (r.status === 200) {
                            return r.json()
                        }
                        
                        if (r.status === 426) {
                            throw new Error(`Too many requests. Try again later.`);
                        }
                        
                        if (r.status === 400) {
                            return r.json().then((data) => {
                                throw new Error(data.error);
                            });
                        }
                        
                        throw new Error(`Unexpected error. Try again later.`);
                    })
                    .then((data) => {
                        onEnd(JSON.stringify(data, null, 4));
                    })
                    .catch((err) => {
                        onEnd(err.message);
                    });
            });
        }, false);
    </script>
</div>
<h2 id="elements-parent-and-siblings">Element&rsquo;s parent and siblings</h2>
<p>With this release, it&rsquo;s possible to direclty access parents and siblings of elements:</p>








<div class="code-editor">

    

    <button id="code-editor-960-run-button" class="run button is-pulled-right is-outlined is-light is-radiusless code-editor-button">Run</button>

    <div class="columns">
        <div class="column is-6">
            <div id="code-editor-960-text" class="code-editor-text" style="height: 200px;">
                
LET doc = DOCUMENT("https://getbootstrap.com/docs/4.5/components/list-group/", { driver: "cdp"})
LET list = ELEMENT(doc, 'ul.list-group')
LET items = ELEMENTS(list, 'li')
LET firstItem = items[0]
LET secondItem = items[1]

RETURN {
    parent: secondItem.parentElement.innerText,
    first: [secondItem.previousElementSibling, firstItem],
    second: [firstItem.nextElementSibling, secondItem]
}

            </div>
        </div>
        <div class="column is-6">
            <div id="code-editor-960-result" class="code-editor-result" style="height: 200px;"></div>
        </div>
    </div>
    

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            function createEditor(id, mode) {
                const editor = ace.edit(id);
                editor.setTheme("ace\/theme\/tomorrow_night");
                editor.session.setMode("ace/mode/" + mode);
                editor.setOptions({
                    displayIndentGuides: false,
                    printMargin: false
                });

                return editor;
            }

            const btn = document.querySelector('#code-editor-960-run-button');
            const textEditor = createEditor('code-editor-960-text', 'aql');
            const resultEditor = createEditor('code-editor-960-result', 'json');
            resultEditor.setReadOnly(true);
                textEditor.setReadOnly(true);

            function setContent(editor, content) {
                editor.setValue(content, -1);
            }

            let isRunning = false;

            function onStart() {
                isRunning = true;
                textEditor.setReadOnly(true);
                btn.classList.add('is-loading');
            }

            function onEnd(result) {
                isRunning = false;
                textEditor.setReadOnly(false);
                btn.classList.remove('is-loading');

                setContent(resultEditor, result);
            }

            btn.addEventListener('click', () => {
                if (isRunning) {
                    return;
                }

                const body = {
                        text: textEditor.getValue(),
                        params: JSON.parse("{}")
                };

                onStart();
                fetch("https:\/\/worker-pucbyp2omq-ue.a.run.app", {
                    method: 'post',
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    signal: AbortSignal.timeout(1000 * 60), 
                    body: JSON.stringify(body)
                })
                    .then(r => {
                        if (r.status === 200) {
                            return r.json()
                        }
                        
                        if (r.status === 426) {
                            throw new Error(`Too many requests. Try again later.`);
                        }
                        
                        if (r.status === 400) {
                            return r.json().then((data) => {
                                throw new Error(data.error);
                            });
                        }
                        
                        throw new Error(`Unexpected error. Try again later.`);
                    })
                    .then((data) => {
                        onEnd(JSON.stringify(data, null, 4));
                    })
                    .catch((err) => {
                        onEnd(err.message);
                    });
            });
        }, false);
    </script>
</div>
<h1 id="whats-fixed">What&rsquo;s fixed</h1>
<h2 id="html-escaping">HTML escaping</h2>
<p>Long lasting issue of HTML escaping has been finally fixed.</p>
<p>The problem was that Go&rsquo;s JSON encoder from the standard library does escaping of HTML strings.</p>

            </div>
        </div>
    </div>

        </div><footer class="footer">
    <div class="columns">
        <div class="column is-4 is-hidden-mobile">
            <p>
                <a href="https://github.com/MontFerret">
                    © 2018-2026 MontFerret Team
                </a>
            </p>
            <p>
                <a href="https://www.montferret.dev/blog/index.xml">RSS</a>
            </p>
        </div>
        <div class="column is-4 has-text-centered">
            <img src="/img/logo.png" width="30" height="30" />
        </div>
        <div class="column is-4 has-text-right is-hidden-mobile">
            <a href="#">BACK TO TOP Δ</a>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/ace.min.js"
        integrity="sha256-qCCcAHv/Z0u7K344shsZKUF2NR+59ooA3XWRj0LPGIQ=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/mode-aql.min.js"
        integrity="sha256-X0EL61aEe9ZmA9OkWgfPw7QMJc2DPs3/RcarIt15j8Y=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/mode-json.min.js"
        integrity="sha256-oMH6MIx8AGl0OseaL8vGcdSb9ons1Jprkf4xXAyzvNc=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/mode-golang.min.js"
        integrity="sha256-0SvSdpO3x7J6KQZ5Y9ghI0wph0l0DDMUaOQu+Swjup0=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/theme-tomorrow_night.min.js"
        integrity="sha256-NbswWaBBhaLvBJ18ocfQ7sC/Iy/+7KvGq0YRjvLRpk4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.11/mode-sh.min.js"
        integrity="sha256-uzCsgXA65+SIa2CRZSX6+Ls6DKZkddI5rtRXr1uOE2Y=" crossorigin="anonymous"></script>
</footer></body>
</html>
